<?php
require_once("../../../DB.php");
require_once("../../../lib.php");
// example on using PHPMailer with GMAIL

$db = new DB();

include("class.phpmailer.php");
include("class.smtp.php"); // note, this is optional - gets called from main class if not already loaded

$emp = $_SESSION['emp'];
$month = $_GET['month'];
$year = $_GET['year'];

$mail             = new PHPMailer();

//$body             = $mail->getFile('../examples/contents.html');
$body             = file_get_contents('contents.html');
//$body             = eregi_replace("[\]",'',$body);

$mail->IsSMTP();
$mail->SMTPAuth   = true;                  // enable SMTP authentication
$mail->SMTPSecure = "ssl";                 // sets the prefix to the servier
$mail->Host       = "smtp.gmail.com";      // sets GMAIL as the SMTP server
$mail->Port       = 465;                   // set the SMTP port

$mail->Username   = "mujoga@gmail.com";  // GMAIL username
$mail->Password   = "josemariaescriva";            // GMAIL password

$mail->From       = "replyto@yourdomain.com";
$mail->FromName   = "RealState HRM";
$mail->Subject    = "Payslip ".getMonth($month)." ".$year;
$mail->AltBody    = ""; //Text Body
$mail->WordWrap   = 50; // set word wrap

$mail->MsgHTML($body);

//$mail->AddAttachment("/path/to/file.zip");             // attachment
//$mail->AddAttachment("/path/to/image.jpg", "new.jpg"); // attachment

$num = count($emp);
$i=0;
while($i<$num){

$employees = new Employees();
$fields="*";
$join="";
$having="";
$groupby="";
$orderby="";
$where=" where id='".$emp[$i]."' and email!=''";
$employees->retrieve($fields,$join,$where,$having,$groupby,$orderby);
$employees=$employees->fetchObject;

  //attach payslip
  $mail->AddAttachment("payslips/".$employees->pfnum."".$month."".$year);
  $mail->AddAddress($employees->email,$employees->firstname." ".$employees->middlename." ".$employees->lastname);

  $mail->IsHTML(true); // send as HTML

  if(!$mail->Send()) {
    echo "Mailer Error: " . $mail->ErrorInfo;
  } else {
    echo "Message has been sent";
  }
}

?>
